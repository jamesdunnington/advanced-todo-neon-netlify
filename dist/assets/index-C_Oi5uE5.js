(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const d="/.netlify/functions/tasks";async function f({q:t="",status:e="all",sort:a="created"}={}){const r=new URL(d,window.location.origin);t&&r.searchParams.set("q",t),e&&r.searchParams.set("status",e),a&&r.searchParams.set("sort",a);const n=await fetch(r.toString(),{credentials:"same-origin"});if(!n.ok)throw new Error("Failed to load tasks");return n.json()}async function y(t){const e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Failed to create task");return e.json()}async function m(t,e){const a=`${d}/${encodeURIComponent(t)}`,r=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Failed to update task");return r.json()}async function p(t){const e=`${d}/${encodeURIComponent(t)}`;if(!(await fetch(e,{method:"DELETE"})).ok)throw new Error("Failed to delete task");return{ok:!0}}const o={search:document.getElementById("search"),status:document.getElementById("status-filter"),sort:document.getElementById("sort-by"),title:document.getElementById("title"),tags:document.getElementById("tags"),due:document.getElementById("due"),priority:document.getElementById("priority"),notes:document.getElementById("notes"),add:document.getElementById("add"),list:document.getElementById("list"),tpl:document.getElementById("item-template")};let c={items:[],q:"",status:"all",sort:"created"};async function l(){const t=await f({q:c.q,status:c.status,sort:c.sort});c.items=t,g()}function g(){o.list.innerHTML="";for(const t of c.items){const e=o.tpl.content.firstElementChild.cloneNode(!0);e.dataset.id=t.id,e.querySelector(".title").textContent=t.title,t.completed&&e.classList.add("completed");const a=e.querySelector(".toggle");a.checked=!!t.completed;const r=e.querySelector(".due");r.textContent=t.due_date?new Date(t.due_date).toLocaleDateString():"";const n=e.querySelector(".priority");n.textContent=`P${t.priority}`;const s=e.querySelector(".tags");(t.tags||[]).forEach(i=>{const u=document.createElement("span");u.className="tag",u.textContent=i,s.appendChild(u)}),a.addEventListener("change",async()=>{await m(t.id,{completed:a.checked}),await l()}),e.querySelector(".delete").addEventListener("click",async()=>{await p(t.id),await l()}),e.querySelector(".edit").addEventListener("click",async()=>{const i=prompt("Edit title",t.title);i&&i.trim()&&(await m(t.id,{title:i.trim()}),await l())}),o.list.appendChild(e)}}o.add.addEventListener("click",async()=>{const t=o.title.value.trim();if(!t)return;const e=o.tags.value.split(",").map(s=>s.trim()).filter(Boolean),a=o.due.value?new Date(o.due.value).toISOString():null,r=parseInt(o.priority.value,10),n=o.notes.value.trim()||null;await y({title:t,tags:e,due_date:a,priority:r,notes:n}),o.title.value="",o.tags.value="",o.due.value="",o.notes.value="",await l()});for(const[t,e]of[[o.search,"q"],[o.status,"status"],[o.sort,"sort"]])t.addEventListener("input",async()=>{c[e]=t.value,await l()});l().catch(t=>{console.error(t),o.list.innerHTML='<li class="item">Failed to load tasks. Check API setup.</li>'});
